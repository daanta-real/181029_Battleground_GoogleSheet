//////////////////// ê°œì¸ì •ë¹„ë¶€ MAIN ////////////////////
function itemPhase (lootedItemList, plNum, player) {
  // ë³€ìˆ˜ ì •ì˜
  var list = lootedItemList; // ë“í…œë‹¨ê³„ì—ì„œ ì–»ì€ ì•„ì´í…œì˜ 2ì°¨ì› ë°°ì—´ ì •ë³´
  var pl = player[plNum]; // í˜„ì¬í”Œë ˆì´ì–´ ì •ë³´ë°°ì—´
  var logtxt = []; // ë¡œê·¸ëŠ” í•œì¤„ë¡œ ëë‚´ì ë˜ë„ë¡ì´ë©´  
//logtxt.push('ì •ë¹„ë¶€ MAIN ì‹œì‘. ë“í…œë¶€í•œí…Œì„œ ë„˜ê²¨ë°›ì€ ë‚´ìš©ë¬¼: ' + basketInfo(list));// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ

  // ì†Œë£¨í‹´ 0. ê°€ë°©í…œ ë‹¤ êº¼ë‚´ì„œ listë¡œ ê°€ì ¸ì˜¤ê³ , ì„ ë¬¼ìƒìì— ìˆëŠ” ë¬¼ê±´ë„ listë¡œ ê°€ì ¸ì˜´  
  var prepared = prepareList(list, pl); // ì¤€ë¹„ ì‹¤í–‰ â†’ [ê°€ë°©í…œê³¼ ì„ ë¬¼ìƒì ë‚´ìš©ì´ ì¶”ê°€ëœ listì™€, í…ìŠ¤íŠ¸ë¡œê·¸ì™€, ê°€ë°©ë‚´ ì•„ì´í…œì´ ëª¨ë‘ ë¹„ì›Œì§„ í”Œë ˆì´ì–´ ë°°ì—´ì •ë³´ pl]ì„ ë¦¬í„´.
  list = prepared[0]; // í…œë¦¬ìŠ¤íŠ¸ ì—…ëƒ ë°˜ì˜
  if(prepared[1] != 'ì—†ìŒ') { logtxt = logtxt.concat(prepared[1]); } // ì•„ì´í…œì‚¬ìš© ê²°ê³¼í…ìŠ¤íŠ¸ ìˆìœ¼ë©´ ë°˜ì˜ (ì—¬ëŸ¬ì¤„ì´ë¼ì„œ concatì„ ì“´ë‹¤.);
  pl = prepared[2]; // ê°€ë°©ì´ ë¹„ì›Œì§„(í˜¹ì€ ê·¸ëŸ´ë“¯í•œ) í”Œë ˆì´ì–´ ë°˜ì˜

  // ì†Œë£¨í‹´ 1. ì¥ë¹„í…œ ì¶”ë ¤ì„œ ì—…ê¸€í•˜ê¸°
  // log('ì†Œë£¨í‹´1 - ì¥ë¹„ì—…ê¸€ ì‹œì‘');
  var upgraded = upgrade(list, pl); // ì–»ì€ ì¥ë¹„ë“¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ë“¤ê³  ì—…ê·¸ë ˆì´ë“œ ì‹¤í–‰ -> [ì´ë²ˆì— íŒë‹¨ëª»í•œ ì”ì—¬ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸, ì „ì²´ ë¡œê·¸, ë³€ê²½ëœ í”Œë ˆì´ì–´ë³€ìˆ˜] ë¦¬í„´ë°›ëŠ”ë‹¤
  list = upgraded[0]; // í…œë¦¬ìŠ¤íŠ¸ ì—…ëƒ ë±ì˜
  if(upgraded[1] != 'ì—†ìŒ') logtxt = logtxt.concat(upgraded[1]); // ì—…ê¸€ ê²°ê³¼í…ìŠ¤íŠ¸ ìˆìœ¼ë©´ ë°˜ì˜
  pl = upgraded[2]; // ì¥ë¹„ë¥¼ ì¥ì°©í•˜ê³  ìƒˆë¡œì›Œì§„ í”Œë ˆì´ì–´
  // logChar(player);
  
  // ì†Œë£¨í‹´ 2. íšŒë³µì•„ì´í…œ ì“°ê¸°
  // log('ì†Œë£¨í‹´2 - íšŒë³µ ì‹œì‘. '+pl[1]+pl[2]+'ì˜ HP = ' + pl[11] + "/" + pl[10]);
  var healUsed = healUse(list, pl); // íšŒë³µ ì‹¤í–‰ â†’ [í”Œë ˆì´ì–´ ê°€ë°©ì—ì„œ ë¹¼ë‚¸ ì•„ì´í…œê¹Œì§€ ë‹¤ ë‹´ê²¨ìˆëŠ” ì¥ë°”êµ¬ë‹ˆ listì™€, í…ìŠ¤íŠ¸ë¡œê·¸ì™€, ê°€ë°©ë‚´ ì•„ì´í…œì´ ëª¨ë‘ ë¹„ì›Œì§„ í”Œë ˆì´ì–´ ë°°ì—´ì •ë³´ pl]ì„ ë¦¬í„´.
  // ì—¬ê¸°ì„œ ê°€ë°©ì— ìˆëŠ” ì•„ì´í…œë“¤ì´ ë‹¤ êº¼ë‚´ì§„ë‹¤. ì£¼ì˜!
  list = healUsed[0]; // í…œë¦¬ìŠ¤íŠ¸ ì—…ëƒ ë±ì˜
  if(!isEmpty(healUsed[1])) { logtxt.push(healUsed[1]); } // ì¹˜ë£Œ ê²°ê³¼í…ìŠ¤íŠ¸ ìˆìœ¼ë©´ ë°˜ì˜ (1ì¤„ì´ë¼ì„œ pushë¥¼ ì“´ë‹¤.)
  pl = healUsed[2]; // íë§í•˜ê³  ìƒˆë¡œì›Œì§„ í”Œë ˆì´ì–´ ë±ì˜
  //logChar(player);

  // ì†Œë£¨í‹´ 3. ê¸°íƒ€ ì‚¬ìš©ì•„ì´í…œ ì“°ê¸°
  var itemUsed = itemUse(list, pl); // ì•„ì´í…œ ì‚¬ìš© ì‹¤í–‰ â†’ [ì¥ë°”êµ¬ë‹ˆ listì™€, í…ìŠ¤íŠ¸ë¡œê·¸ì™€, ì‚¬ìš©í•œ ì•„ì´í…œì´ ë¹ ì§„ í”Œë ˆì´ì–´ ë°°ì—´ì •ë³´ pl]ì„ ë¦¬í„´.
  list = itemUsed[0]; // í…œë¦¬ìŠ¤íŠ¸ ì—…ëƒ ë°˜ì˜
  if(itemUsed[1] != 'ì—†ìŒ') { logtxt = logtxt.concat(itemUsed[1]); } // ì•„ì´í…œì‚¬ìš© ê²°ê³¼í…ìŠ¤íŠ¸ ìˆìœ¼ë©´ ë°˜ì˜ (ì—¬ëŸ¬ì¤„ì´ë¼ì„œ concatì„ ì“´ë‹¤.)
  pl = itemUsed[2]; // íë§í•˜ê³  ìƒˆë¡œì›Œì§„ í”Œë ˆì´ì–´ ë±ì˜
  //logChar(player);

  // ì†Œë£¨í‹´ 9. ê°€ë°©ì— ì•„ì´í…œ ë„£ê¸°
  //log('ì†Œë£¨í‹´9 - ì•„ì´í…œ ì •ë¦¬ ì‹œì‘');
  var adjusted = adjust(list, pl); // ì‚¬ìš©ê³¼ ì—…ê¸€ì´ ë‹¤ ëë‚¬ìœ¼ë©´ ì†Œëª¨í’ˆê³¼ ê°€ë°©ë‚´ìš©ì„ ë‹¤ ëŠ˜ì–´ë†“ê³  ê°€ì§ˆê±´ ê°€ì§€ê³  ë²„ë¦´ê±´ ë²„ë¦¬ëŠ” ëª¨ë“œ. [ë¡œê·¸txt, ê°€ë°©ë¹„ì›Œì§„pl] ì´ ë¦¬í„´ëœë‹¤.
  if(adjusted[0] != 'ì—†ìŒ') logtxt.push(adjusted[0]); // ì§ì •ë¦¬ ê²°ê³¼í…ìŠ¤íŠ¸ ìˆì„ë•Œë§Œ ë°˜ì˜
  pl = adjusted[1]; // ê°€ë°© ë‚´ìš©ì„ ë°”ê¾¸ê³  ìƒˆë¡œì›Œì§„ í”Œë ˆì´ì–´ ë°˜ì˜
  // ì•„ì´í…œ ì—…ê·¸ë ˆì´ë“œëŠ” ë”°ë¡œ í•˜ì§€ ì•ŠìŒ. (ì†Œë£¨í‹´3 ë¯¸ì‚¬ìš©ì•„ì´í…œ ì¶”ë¦¬ê¸° ì—ì„œ ì´ë¯¸ ê±¸ë €ìœ¼ë‹ˆ ê·¸ëŒ€ë¡œ ë²„ë ¤ë„ ë¨. íœ˜ë°œ)
    
  player[plNum] = pl; // ëª¨ë“  ì ˆì°¨ë¥¼ ë§ˆì¹œ í˜„ì¬í”Œë ˆì´ì–´ ì •ë³´ë°°ì—´ ë‚´ìš©ì„ ì „ì²´í”Œë ˆì´ì–´ ë°°ì—´ì—ì„œ ê°±ì‹ ë°˜ì˜
  // ì•„ì´í…œì€ ì±™ê¸¸ê±° ì±™ê¸°ê³  ë‹¤ ë²„ë¦¬ëŠ” ê±°ë‹ˆê¹Œ ë”°ë¡œ ë°˜ì˜í• ê±° ì—†ìŒ. (íœ˜ë°œ)
  //logChar(player);
  
  // ë¡œê·¸ ê¸°ë¡ê³¼ ì—…ëƒëœ í”Œë ˆì´ì–´ ë°°ì—´ë“¤ì„ ê°–ê³  ëŒ€ë£¨í‹´ìœ¼ë¡œ ê·€í™˜
  return [logtxt, player];
  
}

//////////////////// 0 - ì¤€ë¹„ PHASE ////////////////////
function prepareList(list,pl) {

  var logtxt = [];

  //log('[1] í”Œë ˆì´ì–´ ì†Œì§€í’ˆ: (' + ((pl[13] !='x')?item[pl[13]][2]:'') + pl[13] +")("+ ((pl[14] !='x')?item[pl[14]][2]:'') + pl[14]+')');
  //log('0. ì¤€ë¹„ë¶€ ì‹œì‘. ì—…ê¸€ë¶€í•œí…Œì„œ ë„˜ê²¨ë°›ì€ ê²ƒë“¤: ' + basketInfo(list));// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  

  // (1) í”Œë ˆì´ì–´ ê°€ë°©ì† ì§ì„ ë‹¤ êº¼ë‚´ì„œ ë°”êµ¬ë‹ˆì— ì˜®ê²¨ë†“ê³  ë°”êµ¬ë‹ˆë§Œ ë†“ê³  ìƒê°í•˜ê¸°ë¡œí•¨.
  if(pl[13] != 'x') list.push(pl[13]);
  if(pl[14] != 'x') list.push(pl[14]);
  pl[13] = 'x', pl[14] = 'x'; // ğŸ…¾ï¸

  //log("0. ì¤€ë¹„ë¶€, ì¤€ë¹„ëœ ë³´ìƒí’ˆ: " + pl[27] + "," + pl[28]);
  if(pl[27] == 'x' && pl[28] == 'x') {
    //log("ë°œê²¬ëœ ì„ ë¬¼ì—†ìŒ");
    var viptxt = 'none';
  } else {
    var viptxt = pl[1] + pl[2] + ": ì–´ì œ ê³µë¶€ë¥¼ ì—´ì‹¬íˆ í•˜ì—¬ ";
    if(pl[27] != 'x') {
      //log("ì„ ë¬¼1("+pl[27]+item[pl[27]][2]+") ë°œê²¬. ë°”êµ¬ë‹ˆì˜ ê¸¸ì´-" + list.length + ", íƒ€ì…-"+ typeof list + "/ ì „ì²´-" + list + "/ 0ë²ˆ-" + list[0]); 
      viptxt += item[pl[27]][2];
      //log('ë°”êµ¬ë‹ˆì— ë³´ìƒí’ˆ1 ì¶”ê°€ ì§ì „: ë°”êµ¬ë‹ˆ[' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ
      
      // ì•„ì´í…œ ì¢…ë¥˜ì— ë”°ë¼ ì•„ì´í…œì •ë³´ë¥¼ ë§Œë“¬
      var newItem = pl[27];
      var theItem = makeItemInfo(newItem);
      
      list.push(theItem);
      pl[27] = 'x';
      //log('í…œë¦¬ìŠ¤íŠ¸ì— ë³´ìƒí’ˆ1 ì¶”ê°€í•˜ê³  ì„ ë¬¼ìƒì1ì€ ë¹„ì›€. ë°”êµ¬ë‹ˆ[' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);
    }
    if(pl[28] != 'x') {
      //log("ì„ ë¬¼2("+pl[28]+item[pl[28]][2]+") ë°œê²¬. ë°”êµ¬ë‹ˆì˜ ê¸¸ì´-" + list.length + ", íƒ€ì…-"+ typeof list + "/ ì „ì²´-" + list + "/ 0ë²ˆ-" + list[0]); 
      viptxt += item[pl[28]][2];
      //log('ë°”êµ¬ë‹ˆì— ë³´ìƒí’ˆ2 ì¶”ê°€ ì§ì „: ë°”êµ¬ë‹ˆ[' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
      
      // ì•„ì´í…œ ì¢…ë¥˜ì— ë”°ë¼ ì•„ì´í…œì •ë³´ë¥¼ ë§Œë“¬
      var newItem = pl[28];
      var theItem = makeItemInfo(newItem);
  
      list.push(theItem);
      pl[28] = 'x';
      //log('í…œë¦¬ìŠ¤íŠ¸ì— ë³´ìƒí’ˆ2 ì¶”ê°€í•˜ê³  ì„ ë¬¼ìƒì1ì€ ë¹„ì›€. ë°”êµ¬ë‹ˆ[' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);
    }
    viptxt += "ë¥¼ ì–»ì—ˆë‹¤!";
  } 
  
  // ìƒì„ ë°›ì€ê²ƒì´ ìˆëŠ”ì§€ ì ê²€í•˜ì—¬ ìƒ ë¬¸êµ¬ ì¶”ê°€í•¨.
  //log('í”Œë ˆì´ì–´ ìƒë°›ëŠ” ë¬¸êµ¬ > ' + viptxt);
  if(viptxt != 'none') logtxt.push(viptxt);
  else logtxt = 'ì—†ìŒ';
  
  //log('ì†Œë£¨í‹´0. ì•„ì´í…œì¤€ë¹„ ëë‚œì‹œì  ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼: ' + basketInfo(list));
  
  return [list, logtxt, pl];
}


//////////////////// 1 - ì—…ê¸€ PHASE ////////////////////
function upgrade(list, pl) {
  
  var b4attdef = getAttDef(pl); // ê¸°ì¡´ ê³µë°©ë ¥ ì •ë³´
  var plIdxs = {'íƒˆê²ƒ':3, 'ë¬´ê¸°':4, 'í—¤ë“œ':5, 'ì™¸íˆ¬':6, 'ìƒì˜':7, 'ì‹ ë°œ':8, 'í•˜ì˜':9, 'ê°€ë°©':12}; // ë¬¸ìì—´ì„ í†µí•´ idxë¥¼ ì•Œìˆ˜ìˆê²Œ í•´ì£¼ëŠ” ë°°ì—´
  var appliedlist = []; // ì ìš©í•œ ì¥ë¹„ idx ë¦¬ìŠ¤íŠ¸, ë¡œê·¸ìš©ìœ¼ë¡œë§Œ ì“¸ê±°ë‹ˆê¹ 1ì°¨ì› ë°°ì—´ë¡œ í•¨.
  var nextlist = []; // ë¦¬í„´ ë°°ì—´ (ì¥ë¹„ê°€ ëª¨ë‘ ì¶”ì¶œë˜ê³  ì†Œëª¨í’ˆë§Œ ë‚¨ê²Œë ê±°ì„)
  //log('ì†Œë£¨í‹´1. ì—…ê¸€phase ë‚´ë¶€ë¡œ ë“¤ì–´ì˜´');
  

  // í”Œë ˆì´ì–´ ë³€ìˆ˜ ëŠ˜ì–´ë†“ê¸°
//  log(doubleArrayToText(pl));
  //logChar(pl);
  //log('ì†Œë£¨í‹´1. ì—…ê¸€phaseê°€ ë„˜ê²¨ë°›ì€ ë¬¼ê±´ë¦¬ìŠ¤íŠ¸: [' + basketInfo(list) + "] // ê¸¸ì´:" + list.length);// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  

  //DEBUGìš©
  //log("4ë˜ëƒ? ê¸¸ì´-" + list.length + ", íƒ€ì…-"+ typeof list + "/ ì „ì²´-" + list + "/ 0ë²ˆ-" + list[0]); 
  //log('5list ì¶”ê°€ì „ ë¦¬ìŠ¤íŠ¸: [' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
  /////list.concat([59],[82],[45,10],[27],[9],[47],[49],[84],[38,2],[40,2],[44,2],[36,10]); â†’ ë²„ê·¸ë‚˜ì„œ ì•ˆë¨¹í˜ ì´ìœ ëŠ” ëª¨ë¥´ê² ìŒ
  //log('6list ì¶”ê°€í›„ ë¦¬ìŠ¤íŠ¸: [' + basketInfo(list) + "] & ê¸¸ì´:" + list.length);// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
  //log("7ë˜di?"); 
  
//  log("ì„ ë¬¼ì½”ë„ˆ ë, ì¥ë¹„êµì²´íŒŒíŠ¸ë¡œ ë“¤ì–´ì˜´");
  for(var i in list) { // ë¦¬ìŠ¤íŠ¸ ë‚´ ëª¨ë“  ì•„ì´í…œ [idx, ì°¨ëŸ‰ì˜ê²½ìš°ë‚¨ì€íƒ‘ìŠ¹íšŸìˆ˜]
    // 0. ëŒ€ìƒì¥ë¹„ idx ë° íƒ€ì…ì„ êµ¬í•¨
    if (typeof list[i] == 'object' && list[i].length >= 2) var targetIdx = list[i][0]; // ë°°ì—´ ë‘ê°œì§œë¦¬ë©´ íƒˆê²ƒì´ë‚˜ íŠ¹ìˆ˜ì•„ì´í…œì´ë¯€ë¡œ íš¨ê³¼ìˆ˜ì¹˜ë„ ê°™ì´ ë“¤ì–´ìˆëŠ”ê²ƒì„
    else var targetIdx = list[i]; // ë°°ì—´ í•œê°œì§œë¦¬ë©´ ë‹¨ìˆœí…œì„
    var type = item[targetIdx][1]; // í•´ë‹¹ ì•„ì´í…œì˜ íƒ€ì…ëª…('ë¬´ê¸°','ì™¸íˆ¬', ...)
//    log(i+'ë²ˆ ì¥ë¹„ ' + item[targetIdx][2] + '('+type+')');
    
    // 1. ì•„ì´í…œì˜ ì¢…ë¥˜ê°€ ì¥ë¹„ë¥˜ì¸ì§€ í™•ì¸í•¨ (ì¥ë¹„ë¼ í•¨ì€, í˜„ì¬ê¸°ì¤€ íƒˆê²ƒ/ë¬´ê¸°/í—¤ë“œ/ì™¸íˆ¬/ìƒì˜/ì‹ ë°œ/í•˜ì˜/ê°€ë°© 8ì¢…ë¥˜ë¥¼ ë§í•¨)
    if(type == 'íƒˆê²ƒ' || type == 'ë¬´ê¸°' || type == 'í—¤ë“œ' || type == 'ì™¸íˆ¬' || type == 'ìƒì˜' || type == 'ì‹ ë°œ' || type == 'í•˜ì˜' || type == 'ê°€ë°©') {
      
      // ì¥ë¹„ë¼ë©´, newlist ë°°ì—´ì— ë“±ë¡í•˜ì§€ ì•ŠìŒ ì¦‰ í”Œë ˆì´ì–´í•œí…Œ ì˜®ê²¨ê°€ì„œ ì¥ì°©ë˜ê±°ë‚˜, ê·¸ëŒ€ë¡œ ë°”ë‹¥ì— ë²„ë ¤ì§€ê±°ë‚˜ ë‘˜ì¤‘ í•˜ë‚˜ì„
      // 2. í”Œë ˆì´ì–´ idx ë° ì •ë³´ë¥¼ êµ¬í•¨
      //log('2. ì •ë³´êµ¬í•˜ê¸°');
      var idx = plIdxs[type]; // í”Œë ˆì´ì–´ ë°°ì—´ë‚´ ì¥ë¹„ ìœ„ì¹˜. typeì´ ë¬´ê¸°ë©´ 4, ì™¸íˆ¬ë©´ 6, ... ì´ëŸ°ì‹ìœ¼ë¡œ êµ¬í•´ì¤Œ
      var curr = pl[idx]; // í˜„ì¬ í”Œë ˆì´ì–´ì¸¡ ì¥ë¹„ idx
      var aftr = targetIdx; // êµ¬í•  ì¥ë¹„ì˜ idx
      
      // 3-1. í”Œë ˆì´ì–´ ì¥ë¹„ ì—†ì—ˆë˜ê²½ìš°ë©´ 4ë¡œ ë„˜ì–´ê°.
      if (curr == 'x') {
        //log("3-1. í˜„ì¬ ì¥ë¹„ì—†ìŒ. ë‹¹ì—°íˆ ë°”ã…ê¿”ì•¼ì§€");
        var effective = 'ë°”ê¿”ë‚Œ';
      } else {
        
        // 3-2. ì¥ë¹„ë³„ ê°€ì¹˜ ê³„ì‚°
        //log('3-2 ì¥ë¹„ì˜ ê°€ì¹˜ ê³„ì‚°: '+curr+'ë²ˆì•„ì´í…œ('+item[curr]+') vs ' + aftr + 'ë²ˆì•„ì´í…œ('+item[aftr]+')');
        
        // í”Œë ˆì´ì–´ì˜ ì¥ë¹„ì˜ ê°€ì¹˜. íƒˆê²ƒì´ ì•„ë‹ˆë¼ë©´ ì ìˆ˜ëŠ” ì•„ì´í…œ ìì²´ì˜ íš¨ë ¥ì´ë©°, íŠ¹ìˆ˜ë¬´ê¸°ë©´ ì ìˆ˜ ê°€ì‚°ë¨
        var scorePl = item[curr][3];
        if (curr == 63) scorePl += 0.5; // í›„ë¼ì´íŒ¬ì´ë©´ ê°€ì¹˜+0.5. ì¦‰ ëª¨ë“  í›„ë¼ì´íŒ¬ì´ ëª¨ë“  1ë ™ë¬´ê¸° ì¤‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•¨ (ë¬¼ë¡  2ë ™ë¬´ê¸°ë³´ë‹¨ ëœí•˜ê³ )
        if (curr == 86) scorePl += 0.5; // ì˜¤ì§•ì–´íƒˆì´ë©´ ê°€ì¹˜+0.5. ì¦‰ ëª¨ë“  1ë ™í—¤ë“œ ì¤‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•¨ (ë¬¼ë¡  2ë ™í—¤ë“œë³´ë‹¨ ëœí•˜ê³ )
        
        // ì…ìˆ˜ ê²€í† ëŒ€ìƒ ì¥ë¹„ì˜ ê°€ì¹˜. íƒˆê²ƒì´ ì•„ë‹ˆë¼ë©´ ì ìˆ˜ëŠ” ì•„ì´í…œ ìì²´ì˜ íš¨ë ¥ì´ë©°, íŠ¹ìˆ˜ë¬´ê¸°ë©´ ì ìˆ˜ ê°€ì‚°ë¨
        var scoreLi = item[aftr][3]; 
        if (aftr == 63) scoreLi += 0.5; // í›„ë¼ì´íŒ¬ì´ë©´ ê°€ì¹˜+0.5. ì¦‰ ëª¨ë“  í›„ë¼ì´íŒ¬ì´ ëª¨ë“  1ë ™ë¬´ê¸° ì¤‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•¨ (ë¬¼ë¡  2ë ™ë¬´ê¸°ë³´ë‹¨ ëœí•˜ê³ )
        if (aftr == 86) scoreLi += 0.5; // ì˜¤ì§•ì–´íƒˆì´ë©´ ê°€ì¹˜+0.5. ì¦‰ ëª¨ë“  1ë ™í—¤ë“œ ì¤‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•¨ (ë¬¼ë¡  2ë ™í—¤ë“œë³´ë‹¨ ëœí•˜ê³ )
        
        if (type == 'íƒˆê²ƒ') { // íƒˆê²ƒì´ë¼ë©´ ë‚¨ì€ ì‚¬ìš©íšŸìˆ˜ë¥¼ ê³±í•´ì„œ ì¥ë¹„ìì²´ì˜ì´ë™ë ¥xì”ì—¬ì´ë™íšŸìˆ˜ = ì´ì´ë™ê°€ëŠ¥ê±°ë¦¬ ì´ë ‡ê²Œ ì ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤Œ
          scorePl *= pl[18];
          scoreLi *= list[i][1]; // íš¨ê³¼ìˆ˜ì¹˜
          //log("ìƒˆë¡œìš´ íƒˆê²ƒ("+item[aftr][2]+scoreLi+"ì ) vs í”Œë ˆì´ì–´("+item[curr][2]+scorePl+"ì )");
        }
        
        // 3-3. í˜„ ì¥ë¹„í™” ìƒˆ ì¥ë¹„ ê°€ì¹˜ ë¹„êµí•˜ê¸°
        //log('3-3 íš¨ëŠ¥ë¹„êµí•˜ê¸°');
        var effective = ((scoreLi > scorePl) ? 'ë°”ê¿”ë‚Œ' : 'ì•ˆë°”ê¿”ë‚Œ');
        //log("3-3 " + i+"ë²ˆ ì¥ë¹„("+item[aftr][2]+scoreLi+"ì ) vs í”Œë ˆì´ì–´("+item[curr][2]+scorePl+"ì ) => " + effective);        
      }
      
      // 5. ì—†ëŠ” ì¥ë¹„ê°€ ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ê±°ë“ ê°€ í˜¹ì€ ê¸°ì¡´ì— ì¥ë¹„ê°€ ìˆê³  íš¨ë ¥ì´ ê·¸ ì´ìƒì¸ ê²½ìš°ì—ë§Œ ì–»ì€ê±¸ë¡œ ë°”ê¿”ë‚Œ.
      if (effective == 'ë°”ê¿”ë‚Œ') { 
        // 5-2
        //log('5-2. ë°”ê¿”ë‚Œ ok ë°”ê¿”ë‚Œ ì²˜ë¦¬');

        if (type == 'íƒˆê²ƒ') {
          //log("ìƒˆë¡œìš´ íƒˆê²ƒì •ë³´: list=[i][" + list[i] + "], list[i][0]=[" + list[i][0] + "], list[i][1]=[" + list[i][1] + "]");
          pl[3] = list[i][0]; // ğŸ…¾ï¸ í”Œë ˆì´ì–´ê°€ íƒˆê²ƒì„ ë°”ê¿”ë¼ëŠ” ê·¸ìˆœê°„ì„
          pl[18] = list[i][1];// ğŸ…¾ï¸ íƒˆê²ƒë‚´êµ¬ë„ë„ ì ìš©í•´ì¤€ë‹¤.
          // 2-1.3 ìœ ë¦¬í•œ ì •ë³´ë¡œ ë°”ê¿”ë‚€ê±¸ ë¡œê·¸ë¡œ ë‚¨ê¸°ê¸° ìœ„í•´ appliedListì— ì¶”ê°€í•¨
          appliedlist[3] = item[list[i][0]][2]; // ì§€ì •ëœ ë°°ì—´ì˜ ì•„ì´ì½˜ ëŒ€ì¹˜ì‹œí‚¬ ëª©ì . ì¥ë¹„ë¥¼ ì—¬ëŸ¬ë²ˆ ë°”ê¿”ê¼ˆì„ê²½ìš° ìƒê¸¸ ì¤‘ë³µì„ ë§‰ê¸°ìœ„í•¨
        } else {
          pl[idx] = list[i]; // ğŸ…¾ï¸ í”Œë ˆì´ì–´ê°€ ì¥ë¹„ë¥¼ ë°”ê¿”ë¼ëŠ” ê·¸ìˆœê°„ì„
          // 2-1.3 ìœ ë¦¬í•œ ì •ë³´ë¡œ ë°”ê¿”ë‚€ê±¸ ë¡œê·¸ë¡œ ë‚¨ê¸°ê¸° ìœ„í•´ appliedListì— ì¶”ê°€í•¨
          switch(type) { // ì§€ì •ëœ ë°°ì—´ì˜ ì•„ì´ì½˜ ëŒ€ì¹˜ì‹œí‚¬ ëª©ì . ì¥ë¹„ë¥¼ ì—¬ëŸ¬ë²ˆ ë°”ê¿”ê¼ˆì„ê²½ìš° ìƒê¸¸ ì¤‘ë³µì„ ë§‰ê¸°ìœ„í•¨
            case 'íƒˆê²ƒ' : var applyNo = 3; break;
            case 'ë¬´ê¸°' : var applyNo = 4; break;
            case 'í—¤ë“œ' : var applyNo = 5; break;
            case 'ì™¸íˆ¬' : var applyNo = 6; break;
            case 'ìƒì˜' : var applyNo = 7; break;
            case 'ì‹ ë°œ' : var applyNo = 8; break;
            case 'í•˜ì˜' : var applyNo = 9; break;
            case 'ê°€ë°©' : var applyNo = 12; break;
          }
          // ë°”ê¿”ë‚€ ì¥ë¹„ëª©ë¡ì„ ì•„ì´ì½˜í™”í•´ì„œ í…ìŠ¤íŠ¸ë¡œ ì €ì¥í•´ ë¡œê·¸ ë³´ë‚¼ ìš©ë„ë¡œ ì“°ëŠ” ë¬¸ìì—´ì´ë‹¤.
          appliedlist[applyNo] = item[list[i]][2]; 
        }
      }
    } else { // ê·¸ì™¸ ëª¨ë“  ì¥ë¹„ (íšŒë³µ, ê¸°íƒ€)
      // 2-2. ì¥ë¹„ê°€ ì•„ë‹ˆë‹ˆê¹Œ, ì—¬ê¸°ì„œ íŒë‹¨í•  ë¬¼ê±´ì´ ì•„ë‹ˆë¯€ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë³´ë‚´ê¸° ìœ„í•´ ì‚´ë¦¼ (newlist ë°°ì—´ì— ë“±ë¡ë§Œ í•˜ê³ , ë‹¤ìŒ ë‹¨ê³„ í•¨ìˆ˜ë¡œ ë„˜ê¸¸ê±°ì„)
      //log('ì¥ë¹„ê°€ ì•„ë‹ˆë¯€ë‹ˆë‹¤');
      nextlist.push(list[i]);
    }
  }
  
  // âœ… ì¥ì°©ì´ ëë‚œ ìƒíƒœë¼ë©´ ì—…ê·¸ë ˆì´ë“œ ë¬¸ìì—´ ëª¨ì•„ì„œ ë¦¬í„´í•´ì¤€ë‹¤.
  var logtxt = [];
  
  // ì—…ê·¸ë ˆì´ë“œí•œ ë­”ê°€ê°€ ìˆëŠ”ì§€ ì ê²€í•˜ì—¬ ë¡œê·¸í…ìŠ¤íŠ¸ì— ì¶”ê°€í•¨.
  //   var b4attdef = getAttDef(pl); // ê¸°ì¡´ ê³µë°©ë ¥ ì •ë³´
  if (appliedlist.length > 0) { 
    var aftraffdef = getAttDef(pl); // ë³€ê²½í›„ ê³µê²©ë ¥
    var logs = pl[1] + pl[2] + ": ì¥ë¹„ (" + appliedlist.join('') + ") ì¥ì°©";
    if(aftraffdef[0] > b4attdef[0]) logs += " [âš”ï¸" + b4attdef[0] + " â†’ " + aftraffdef[0] + "]";
    if(aftraffdef[1] > b4attdef[1]) logs += " [ğŸ›¡ï¸" + b4attdef[1] + " â†’ " + aftraffdef[1] + "]";
    logtxt.push(logs);
  }

  // ìœ„ì˜ ë‘ ë¡œê·¸ì •ë¦¬ ê³¼ì •ì„ ê±°ì¹˜ê³  ë‚˜ì„œ ì•„ë¬´ ë©”ì„¸ì§€ ë³€í™”ê°€ ì—†ë‹¤ë©´, 'ì—†ìŒ'ìœ¼ë¡œ ë¦¬í„´í•˜ê¸° ìœ„í•´ ë³€ìˆ˜ë¥¼ ë°”ê¿”ì¤€ë‹¤.
  if(logtxt.length == 0) logtxt = 'ì—†ìŒ';
  
/*  debugConsoleLog("ë¡œê·¸í…ìŠ¤íŠ¸ë‚´ìš©:"+logtxt);
  debugConsoleLog("ë¡œê·¸í…ìŠ¤íŠ¸ê¸¸ì´:"+logtxt.length);
  debugConsoleLog("ë¡œê·¸í…ìŠ¤íŠ¸[0]="+logtxt[0]);
  debugConsoleLog("ë¡œê·¸í…ìŠ¤íŠ¸[1]="+logtxt[1]);*/
  //debugConsoleLog(logtxt);
  
  return [nextlist, logtxt, pl]; // ì´ë²ˆ ë‹¨ê³„ì—ì„œ ì ìš©ì—¬ë¶€ íŒë‹¨í•˜ì§€ ëª»í•œ ì”ì—¬ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ì™€, ì „ì²´ ë¡œê·¸ì™€, ë³€ê²½ëœ í”Œë ˆì´ì–´ë³€ìˆ˜ ë¦¬í„´
}

//////////////////// 2 - íšŒë³µ PHASE ////////////////////
function healUse(list, pl) {
  
  var logtxt = '';
  
  // ë‚´ìš©ë¬¼ ê³µê°œ(debug)
  //log("ì†Œë£¨í‹´2. íšŒë³µ ë“¤ì–´ì˜´");

  // (2) ì§ì„ ë‹¤ ëŠ˜ì–´ë†“ì€ ìƒí™©ì—ì„œ íšŒë³µì•„ì´í…œì„ ì¶”ë ¤ë´„
  var healtemlist = []; // ìš” ë³€ìˆ˜ì•ˆì— íí…œidxë§Œ ì¶”ë ¤ë‚´ì„œ ëª¨ì„ê±°ì„
  for(var i in list) {
    // ë¬¼í’ˆì˜ ì¥ë¹„ idx ë° íƒ€ì…ì„ êµ¬í•¨
    if (typeof list[i] == 'object' && list[i].length >= 2) var targetIdx = list[i][0]; // ë°°ì—´ ë‘ê°œì§œë¦¬ë©´ íƒˆê²ƒì€ ì•„ê¹Œ ë²„ë ¸ìœ¼ë‹ˆê¹Œ ì´ê±´ íŠ¹ìˆ˜ì•„ì´í…œì¼ê²ƒì´ë¯€ë¡œ íš¨ê³¼ìˆ˜ì¹˜ë„ ê°™ì´ ë“¤ì–´ìˆëŠ”ê²ƒì„
    else var targetIdx = list[i]; // ë°°ì—´ í•œê°œì§œë¦¬ë©´ ë‹¨ìˆœí…œì„
    var type = item[targetIdx][1]; // í•´ë‹¹ ì•„ì´í…œì˜ íƒ€ì…ëª… êµ¬í•¨('ë¬´ê¸°','ì™¸íˆ¬', ...)
    if (type == 'íšŒë³µ') healtemlist.push(list[i]); // íšŒë³µì•„ì´í…œì€ ë¬´ì¡°ê±´ ë°°ì—´ í•œê°œì§œë¦¬ë¼ê³  ìƒê°í•˜ì.. ì—…ë°ì´íŠ¸ëŠ” ë‚˜ì¤‘ì— í•˜ì..
  }

  // ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ (debug)
  //log('ì†Œë£¨í‹´2. íšŒë³µ ë“¤ì–´ì˜¨ì‹œì  ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼: ' + basketInfo(list));
  // íí…œë¦¬ìŠ¤íŠ¸ ê³µê°œ (debug)
  //log('   ã„´ ê·¸ì¤‘ì— íí…œ: '+ basketInfo(healtemlist));
  
  // (3) íšŒë³µí…œì´ ìˆìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ. ì•„ë‹ˆë©´ healë¶€ ì „ì²´ë¥¼ ê±´ë„ˆëœ€.
  if(!isEmpty(healtemlist)) {
    
    // 1 ê´€ë ¨ë³€ìˆ˜ ì¤€ë¹„
    var hpLack = pl[10] - pl[11]; // ëª¨ìë€ hpëŸ‰
    var heal1list = [], heal2list = []; // í 1ì§œë¦¬ ë¦¬ìŠ¤íŠ¸ë‘ í 2ì§œë¦¬ ë¦¬ìŠ¤íŠ¸ ëª©ë¡ì„ ê°ê° ë§Œë“¬
    var hplimitup = false; // ìµœëŒ€HP ëŠ˜ì–´ë‚¬ëŠ”ì§€ ì—¬ë¶€
    for(var j in healtemlist) { // ì•„ê¹Œ ì¶”ë¦° ì „ì²´ íí…œë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” idxë“¤ ì¤‘ì—ì„œ
      if(item[healtemlist[j]][3] == 1) heal1list.push(healtemlist[j]); // íëŸ‰ì´ 1ì´ë©´ heal 1 listì— ë„£ê³ 
      else if(item[healtemlist[j]][3] == 2) heal2list.push(healtemlist[j]); // íëŸ‰ì´ 2ì´ë©´ heal 2 listì— ë„£ëŠ”ë‹¤.
    }
//log('[3]íšŒë³µí…œì„ ì¶”ë ¸ë‹¤. í1ì§œë¦¬í…œëª©ë¡:'+heal1list +' / í2ì§œë¦¬í…œëª©ë¡:'+heal2list);
    var choice = 'none'; // ë¨¹ê¸°ë¡œ ì„ íƒí•  í…œ idx, ê¸°ë³¸ì ìœ¼ë¡œ ë¯¸ì„ íƒí•˜ìëŠ” ë§ì„.

    // 2 ì²´ë ¥ì— ë”°ë¼ íšŒë³µì•½ ì‚¬ìš©ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê³ , ì‚¬ìš©í•œë‹¤ í–ˆì„ ì‹œ ë² ìŠ¤íŠ¸ íšŒë³µì•„ì´í…œì„ ì„ íƒí•œë‹¤.
    if (hpLack == 1) { 
      // 1. ì²´ë ¥ 1ë¶€ì¡±ì‹œ (ê²½ìš°ì˜ ìˆ˜ 1/2, 2/3)
      // 1ì§œë¦¬í…œ ìš°ì„  ì„ íƒ > ì—†ìœ¼ë©´ 2ì§œë¦¬í…œ ì„ íƒ
      if(!isEmpty(heal1list)) choice = randomItem(heal1list);
      else if(!isEmpty(heal2list)) choice = randomItem(heal2list);
    } else if (hpLack == 2) {
      // 2. else ì²´ë ¥ 2ë¶€ì¡±ì‹œ (ê²½ìš°ì˜ ìˆ˜ 1/3)
      // 2ì§œë¦¬í…œ ìš°ì„  ì„ íƒ > ì—†ìœ¼ë©´ 1ì§œë¦¬í…œ ì„ íƒ
      if(!isEmpty(heal2list)) choice = randomItem(heal2list);
      else if(!isEmpty(heal1list)) choice = randomItem(heal1list);      
    } else if (pl[10] == pl[11] && (pl[10] == 1 || pl[10] == 2)) {
      // 3. else ì²´ë ¥ì´ ê½‰ì°¬ìƒíƒœê³  ê·¸ë ‡ê²Œ ì°¬ ìµœëŒ€ì²´ë ¥ì´ 1 í˜¹ì€ 2 ì¼ ì‹œ (ê²½ìš°ì˜ ìˆ˜ 1/1, 2/2)
      // 1ì§œë¦¬í…œ ìš°ì„  ì„ íƒ > ì—†ìœ¼ë©´ 2ì§œë¦¬í…œ ì„ íƒ
      if(!isEmpty(heal1list)) choice = randomItem(heal1list);
      else if(!isEmpty(heal2list)) choice = randomItem(heal2list);
    } // ì„¸ ê²½ìš°ê°€ ì•„ë‹Œ ê²½ìš°ëŠ” 3/3ë°–ì— ì—†ìœ¼ë¯€ë¡œ, ìì—°ìŠ¤ëŸ½ê²Œ choiceëŠ” noneì´ ë˜ì–´, ì•„ë¬´ ì•½ë„ ì„ íƒí•˜ì§€ ì•Šê²Œ ë˜ê³ , 3ì„ ê±´ë„ˆë›´ë‹¤.

    // 3 ê³ ë¥¸ ì•„ì´í…œì´ ìˆê¸´ ìˆìœ¼ë©´ - ì¦‰ ì•„ì´í…œì„ ì“°ê¸°ë¡œ í–ˆìœ¼ë©´ - ì•„ì´í…œì„ ì“°ê³  ë°”êµ¬ë‹ˆì—ì„œ ì§€ìš´ë‹¤.
    if(choice != 'none') {
      // 3-1 íšŒë³µì•„ì´í…œ ì‚¬ìš© > íš¨ê³¼ì ìš©(HPíšŒë³µ)
      var healpower = item[choice][3]; // ííŒŒì›Œ ì¸¡ì •
      var healMinus = 0; // ê³¼ë‹¤íšŒë³µì‹œ ë§ˆì´ë„ˆìŠ¤í•´ì•¼ë˜ëŠ” íšŒë³µëŸ‰
      if (hpLack > 0) { // 1) ì²´ë ¥ ë¶€ì¡±ì‹œ (ê²½ìš°ì˜ ìˆ˜ 1/2, 2/3), (ê²½ìš°ì˜ ìˆ˜ 1/3)
        pl[11] += healpower; // ííŒŒì›Œë§Œí¼ í˜„ì²´ë ¥ ë”í•˜ê¸° (ì²´ë ¥ íšŒë³µ)
        if(pl[11] > pl[10]) {
          pl[11]--; // but HPê°€ ì˜¤ë²„íšŒë³µ ëìœ¼ë©´ ìµœëŒ€ì²´ë ¥ìœ¼ë¡œ ë‚®ì¶°ì¤€ë‹¤.
          healMinus = -1; // ë‚˜ì¤‘ì— ë¡œê·¸í…ìŠ¤íŠ¸ì—ì„œ íë§ˆì´ë„ˆìŠ¤ í•´ì¤˜ì•¼ë¨
        }
      } else { // 2) ìµœëŒ€ì²´ë ¥ 1 or 2 ìƒíƒœì—ì„œ ì²´ë ¥ ë§Œë•…ì¼ë•Œ ì‚¬ìš©ì‹œ (ê²½ìš°ì˜ ìˆ˜ 1/1, 2/2)
        hplimitup = true;
        pl[10]++; // ìµœëŒ€ì²´ë ¥ë§Œ ëŠ˜ë ¤ì£¼ëŠ”ê±°ì„. í˜„ì¬HPëŠ” ë‚˜ì¤‘ì— ë‹¤ë¥¸ ë¬¼ì•½ìœ¼ë¡œ íšŒë³µí•˜ì‹œê³ ~
      }
      pl[23]++; // ëƒ ìˆ˜+1
      // 3-2 íš¨ê³¼ ë°˜ì˜ ì™„ë£Œëìœ¼ë©´ ë°”êµ¬ë‹ˆì— ìˆëŠ” í•´ë‹¹ íšŒë³µí…œ ë°°ì—´ì—ì„œ ì œê±° â†’ í”Œë ˆì´ì–´ê°€ íŠ¹ì •idxì˜ ë¥¼ ë¨¹ëŠ”ê±°ê¸°ë•Œë¬¸ì— ë¬´ì‘ì • ë°°ì—´ spliceí•˜ë©´ ì•ˆë¨!
      // idxì°¾ì•„ì„œ idxê°€ ê°™ì€ë†ˆì„ ì§€ì›Œì¤˜ì•¼ë¨. 0idx 10ìµœëŒ€HP 11í˜„ì¬HP 13ê°€ë°©ë³´ê´€ë¬¼1 14ê°€ë°©ë³´ê´€ë¬¼2    
      var deleteTarget = false;
      for(var i in list) {
        if(typeof list[i] == 'object' && list[i].length >= 2) var targetIdx = list[i][0]; // ë°°ì—´ ë‘ê°œì§œë¦¬ë©´ íƒˆê²ƒì€ ì•„ê¹Œ ë²„ë ¸ìœ¼ë‹ˆê¹Œ ì´ê±´ íŠ¹ìˆ˜ì•„ì´í…œì¼ê²ƒì´ë¯€ë¡œ íš¨ê³¼ìˆ˜ì¹˜ë„ ê°™ì´ ë“¤ì–´ìˆëŠ”ê²ƒì„
        else var targetIdx = list[i]; // ë°°ì—´ í•œê°œì§œë¦¬ë©´ ë‹¨ìˆœí…œì„
        if(targetIdx == choice) deleteTarget = i; // listì˜ ië²ˆì§¸ ë†ˆì˜ idxê°€ ë‚´ê°€ ë¨¹ì€ íì•½ì˜ idxì™€ ê°™ë‹¤ë©´, ë°°ì—´ì˜ ëª‡ë²ˆì§¸ì¸ì§€ ê¸°ì–µí•´ë‘”ë‹¤.
      }
      // âœ… ë¡œê·¸ ì“°ê¸°
      logtxt += pl[1]+pl[2]+': íšŒë³µ(' + item[choice][2] + item[choice][4] + ") ëƒ ëƒ ... ";
      if(hplimitup == true) logtxt += "HP + ğŸ’– / ìµœëŒ€ HPê°€ 1 ëŠ˜ì–´ë‚¬ë‹¤!";
      else {
        var healed = healpower + healMinus;
        logtxt += "HP + "+ (healed==2? 'â¤ï¸ï¸â¤ï¸ï¸' : 'â¤ï¸ï¸');
      }
      //var txts = 'ì „ì²´ë¦¬ìŠ¤íŠ¸ <';
      // for(var j in list) txts += item[list[j]][2] + list[j] ;
      //txts += '>ì˜ ìƒí™©ì—ì„œ ' + item[list[deleteTarget]][2] + list[deleteTarget] + 'ì˜ ì•½ì„ ë¨¹ì—‡ë‹¤. ì§€ìš°ê²Ÿë‹¤. ì§€ìš´ê²°ê³¼ ';
      // íì•½ ì¼ìœ¼ë©´ ë°”êµ¬ë‹ˆ í–‰ë ¬ì—ì„œ ëº´ë‚¸ë‹¤
      list.splice(deleteTarget, 1); 
      // for(var k in list) txts += item[list[k]][2] + list[k] ;
      //txts += 'ê°€ ëë‹¤.';
      //log(txts);
      //log("ì†Œë£¨í‹´2 - íšŒë³µ ë, ë¡œê·¸ ì˜ˆìƒë©”ì„¸ì§€: " + logtxt);
    }
  }
  // ì¥ë°”êµ¬ë‹ˆ listì™€, í…ìŠ¤íŠ¸ë¡œê·¸ì™€, í”Œë ˆì´ì–´ ë°°ì—´ì •ë³´ plì„ ë¦¬í„´.
  // 1* ë§Œì•½ íšŒë³µí…œì´ ì—†ìœ¼ë©´ íšŒë³µì•½ ì‚¬ìš© ë£¨íŠ¸ì¸ (3)ì„ í†µì§¸ë¡œ ìƒëµí•˜ê²Œ ë˜ê³ , choice='none'ìœ¼ë¡œ íšŒë³µì•½ ì•ˆì“´ë‹¤.
  // 2* í˜¹ì€ íšŒë³µí…œì´ ê°€ë°©ë‚´ì— ìˆëŠ”ë° ì²´ë ¥ì´ 3/3ì¸ ê²½ìš°ì—ë„ choice='none'ìœ¼ë¡œ íšŒë³µì•½ ì•ˆì“´ë‹¤.
  // ì´ ë‘ê°€ì§€ ê²½ìš°ëŠ” ë¬¼ê±´ì„ listë°”êµ¬ë‹ˆì— ì˜®ê²¨ë‹´ê¸°ë§Œ í•˜ê³  return í•˜ëŠ” ê¼´ì´ ëœë‹¤.
  // ê·¸ëŸ¬ë‚˜ ííŒ©ì„ ì“´ ê²½ìš°ì—ëŠ” ê±°ê¸°ì„œ listì—ì„œ ìê¸°ê°€ ì“´ íí…œì´ í•˜ë‚˜ ì‚­ì œëœì±„ë¡œ ë¦¬í„´í•˜ê²Œ ëœë‹¤.
//log("[2] ì •ë¹„ë¶€-íšŒë³µë¶€ ìµœì¢… ë¡œê·¸> ");
//log(logtxt);
  return [list, logtxt, pl];
}

//////////////////// 3 - ì•„ì´í…œ ì‚¬ìš© PHASE ////////////////////
function itemUse(list, pl) {
  var logtxt = [];
  //log('ì†Œë£¨í‹´3. ì•„ì´í…œì‚¬ìš© ë“¤ì–´ì˜´. ì¼ë‹¨ ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼' + basketInfo(list));// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
  
  for(var i = 0;i < list.length; i++) {
    //log(i);
    //log(doubleArrayToText(list));
    //log(i+"ë²ˆì§¸ ì•„ì´í…œ "+doubleArrayToText(list[i])+"ê²€ì‚¬");
    if(list[i][0] == 89) { // ië²ˆì§¸ ë¦¬ìŠ¤íŠ¸ê°€ ì—°ë£Œí†µì´ë©´
      if(pl[3] >= 0) { // í”Œë ˆì´ì–´ê°€ íƒˆê²ƒì„ ê°–ê³  ìˆë‹¤ë©´
        //log(i+"ë²ˆì§¸ ì•„ì´í…œ " +doubleArrayToText(list[i]) + "ë¥¼ ì œê±°í•©ë‹ˆë‹¤.");
        var plus = 4; // ì„ìœ í†µì— ì„¤ì •ëœ íƒˆê²ƒë‚´êµ¬ë„ ì¦ë¶„
        logtxt.push(pl[1] + pl[2] + ": " + item[pl[3]][2] + item[pl[3]][4] + "ì— ì—°ë£Œ(ğŸ›¢)ë¥¼ ì½¸ì½¸ ë¶€ì—ˆë‹¤! / ì”ì—¬íšŸìˆ˜: " + pl[18] + " â†’ " + (Number(Number(pl[18])+plus)));
        pl[18] += plus; // íƒˆê²ƒë‚´êµ¬ë„ +4
        list.splice(i, 1); // ì¼ìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œí•¨
      }
    }
    

  }
  
  //debugConsoleLog(logtxt);
  //log('ì†Œë£¨í‹´3. ì•„ì´í…œì‚¬ìš© ê²°ê³¼ ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼' + basketInfo(list));// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
  return [list, logtxt, pl];
}

//////////////////// 9 - ê°€ë°©ì— ì•„ì´í…œ ë„£ê¸° PHASE ////////////////////
function adjust(list, pl) {
  // ê°€ë°© ì•ˆì˜ ë¬¼ê±´ê³¼ listì˜ ì†Œëª¨í’ˆì„ ëª¨ë‘ ë‚´ë†“ê³ , ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ê°€ë°©ì— ë¬¼ê±´ì„ ë‹¤ì‹œ ë„£ê³  ë‚˜ë¨¸ì§€ ë‹¤ ë²„ë¦¼

  // ì´ì‹œì ì—ì„œ ì¥ë¹„ëŠ” ë‹¤ë²„ë ¸ê³ , í•„ìš”í•œ ííŒ©ì€ í•œê°œëŠ” ë¨¹ì—ˆì„ ê²ƒì´ë‹¤. ì•„ë¬´íŠ¼ ë°”êµ¬ë‹ˆ ì•ˆì— ì†Œëª¨í’ˆê³¼ íŠ¹ìˆ˜í…œë§Œì´ ë‚¨ëŠ”ë‹¤.
  // ì´ ì¤‘ì—ì„œ ë‘ ê°œì˜ ì•„ì´í…œë§Œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆìœ¼ë©°, ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ë²„ë¦¼.
  // ì•„ì´í…œ ì±™ê¸°ê¸° ìš°ì„ ìˆœìœ„ë³„ë¡œ ì•„ì´í…œì„ ë‹´ì•„ê°€ë©´ì„œ, ê°€ë°© ê°œìˆ˜ê°€ ê½‰ì°¨ë©´ ë‚˜ë¨¸ì§€ ì „ë¶€ë¥¼ í¬ê¸°í•œë‹¤.
  //log('ê°€ë°©phaseì˜´. ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼' + basketInfo(list));// ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ë¬¼ ê³µê°œ  
  
  var virtualBag = new Array(); // ê°€ìƒì˜ ì‡¼í•‘ë°±ì„.  
  var rooms = getBagRooms(pl); // ë¹ˆê³µê°„ ê°œìˆ˜ë‹¤. ì§€ê¸ˆì€ ê°€ë°©ì´ ë‹¤ ë¹„ì›Œì ¸ìˆì„í…Œë‹ˆ ë¬´ì¡°ê±´ ê°€ë°©ê³µê°„ë§Œí¼ ë‚˜ì˜¨ë‹¤.
  //log('ì†Œë£¨í‹´9 ê°€ë°©phaseì˜´. í˜„ì¬ ë°ì´í„°ìƒ ê°€ë°©: '+((pl[12] != 'x' )?+item[pl[12]][3]+'ì¹¸ì§œë¦¬':'ì—†ìŒ') + ' / ë‚´ìš©ë¬¼: ' + pl[13] + ', ' + pl[14] + "ê°€ë°©ì—¬ìœ ê³µê°„:" + rooms);
  
  // 1. ííŒ©ë¶€í„° ì¡ì•„ë„£ê¸° (2ë ˆë²¨ > ì•„ë¬´ë ˆë²¨ ìˆœ)
  if(virtualBag.length < rooms) { // 0 < ê°€ë°©ê³µê°„ì„. ì¦‰ ê°€ë°©ê³µê°„ì´ 1ê°œë‚˜ 2ê°œë©´ ì´ ifë¬¸ì€ ì‹¤í–‰ëœë‹¤.
    //log('ê°€ìƒë°± í¬ê¸°:'+ virtualBag.length + " vs ë‚´ ê°€ë°©ê³µê°„í¬ê¸°: "+ rooms + "ì—ì„œ íë¶€í„° ì°¾ì•„ë³¼ê¹Œìš”?");
    var heal = findObj(list, 'íšŒë³µ', 2); // 1) 2ë ˆë²¨ ì¹˜ë£Œì œë¥¼ ì°¾ì•„ë³¸ë‹¤.
    //log("   ã„´ 2ë ˆë²¨ ì¹˜ë£Œì œ ì°¾ì•„ë³¸ ê²°ê³¼:" + heal + "(" + heal[0] + ", " + heal[1] +")");
    if(heal[0] == 'none') { // 2) 2ë ˆë²¨ì—ì„œ ì•ˆë‚˜ì˜¤ë©´ ë ˆë²¨ ìƒê´€ë§ê³  ì°¾ì•„ë³¸ë‹¤.
      heal = findObj(list, 'íšŒë³µ'); 
      //log("   ã„´ 2ë ˆë²¨ ì¹˜ë£Œì œ ì•ˆë‚˜ì™€ì„œ ì•„ë¬´ ì¹˜ë£Œì œë‚˜ ì°¾ì•„ë³¸ ê²°ê³¼:" + heal + "(" + heal[0] + ", " + heal[1] +")");
    }
    if(heal[0] != 'none') { // 2ë ˆë²¨ì„ ì°¾ì•˜ë˜ê°€ ëª»ì°¾ì•„ì„œ 1ë ˆë²¨ì´ë¼ë„ ì°¾ì•˜ë˜ê°€ ì•„ë¬´íŠ¼ ííŒ©í•˜ë‚˜ì°¾ê¸° ì„±ê³µí•˜ë©´
      virtualBag.push(heal[1]); // heal[0] â‡’ list ë‚´ì˜ ìˆœì„œ ëª‡ë²ˆì§¸ì¸ì§€, heal[1] â‡’ ê·¸ idxê°€ ë¨¼ì§€ ì •ë³´ë¥¼ ë‹´ìŒ. heal[1] ì´ë‹ˆê¹Œ idxê°€ ë“¤ì–´ê°€ëŠ”ê±°ê² ì§€
      //log("í…œì°¾ì•„ë„£ê¸° 1. ì²«ííŒ© "+heal[1]+" ì°¾ì•„ì„œ ì¡ì•„ë„£ìŒ. ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1]);
      list.splice(heal[0], 1); // íì•½ ì¼ìœ¼ë©´ ë°”êµ¬ë‹ˆì—ì„œ ë¹¼ë‚´ì„œ ë²„ë¦°ë‹¤
    }
  }
  
  // 2. ì„±ì¥ì•„ì´í…œ ì¡ì•„ë„£ê¸° (ğŸ’ŸğŸ’Ÿ í–¥í›„ ì—…ëƒí•„ìš”)
  
  // 3. ë²„í”„ì•„ì´í…œ ì¡ì•„ë„£ê¸° (ğŸ’Ÿ í˜„ì¬ í’ì„ ë§Œ ë ê±°ê°™ë‹¤) 
  if(virtualBag.length < rooms) { // ê°€ìƒì‡¼í•‘ë°± ê°œìˆ˜ < ê°€ë°©ê³µê°„ ê°œìˆ˜ ì¡°ê±´ì„. ì¦‰ ê°€ë°©ê³µê°„ì´ ë”í¬ê²Œ ë‚¨ìœ¼ë©´ ì´ ifë¬¸ì€ ì‹¤í–‰ëœë‹¤.
   //log('ê°€ìƒë°± í¬ê¸°:'+ virtualBag.length + " vs ë‚´ ê°€ë°©ê³µê°„í¬ê¸°: "+ rooms + "ì—ì„œ ê¸°íƒ€ì•„ì´í…œì„ ì°¾ì•„ë³¼ê¹Œìš”?");
    var buff = findObj(list, 'ê¸°íƒ€'); // 1) ê¸°íƒ€ë¥˜ë¥¼ ì°¾ì•„ë³¸ë‹¤.
    if(buff[0] != 'none') { // ë²„í”„ë¥¼ í•˜ë‚˜ë¼ë„ ì°¾ìœ¼ë©´
      virtualBag.push(buff[1]); // ì‡¼í•‘ë°±ì— idx ì¨ë„£ëŠ”ë‹¤
      //log("ã„´ì°¾ì•˜ìŒ ì°¾ì•„ë„£ê¸° 3. ì²«ë²„í”„ì•„ì´í…œ "+buff[1]+" ì°¾ì•„ì„œ ì¡ì•„ë„£ìŒ. ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1]);
      list.splice(buff[0], 1); // ì“´ idxëŠ” ë°”êµ¬ë‹ˆì—ì„œ ë¹¼ë‚´ì„œ ë²„ë¦°ë‹¤
    }
  }
  
  // 4. ííŒ©ë¶€í„° ì¡ì•„ë„£ê¸° (2ë ˆë²¨ > ì•„ë¬´ë ˆë²¨ ìˆœ)
  if(virtualBag.length < rooms) { // 0 < ê°€ë°©ê³µê°„ì„. ì¦‰ ê°€ë°©ê³µê°„ì´ 1ê°œë‚˜ 2ê°œë©´ ì´ ifë¬¸ì€ ì‹¤í–‰ëœë‹¤.
    //log('ê°€ìƒë°± í¬ê¸°:'+ virtualBag.length + " vs ë‚´ ê°€ë°©ê³µê°„í¬ê¸°: "+ rooms + "ì—ì„œ ííŒ©ì„ ë‹¤ì‹œ ì°¾ì•„ë³¼ê¹Œìš”?");
    var heal = findObj(list, 'íšŒë³µ', 2); // 1) 2ë ˆë²¨ ì¹˜ë£Œì œë¥¼ ì°¾ì•„ë³¸ë‹¤.
    //log("   ã„´ 2ë ˆë²¨ ì¹˜ë£Œì œ ì°¾ì•„ë³¸ ê²°ê³¼:" + heal + "(" + heal[0] + ", " + heal[1] +")");
    if(heal[0] == 'none') { // 2) 2ë ˆë²¨ì—ì„œ ì•ˆë‚˜ì˜¤ë©´ ë ˆë²¨ ìƒê´€ë§ê³  ì°¾ì•„ë³¸ë‹¤.
      heal = findObj(list, 'íšŒë³µ'); 
      //log("   ã„´ 2ë ˆë²¨ ì¹˜ë£Œì œ ì•ˆë‚˜ì™€ì„œ ì•„ë¬´ ì¹˜ë£Œì œë‚˜ ì°¾ì•„ë³¸ ê²°ê³¼:" + heal + "(" + heal[0] + ", " + heal[1] +")");
    }
    if(heal[0] != 'none') { // 2ë ˆë²¨ì„ ì°¾ì•˜ë˜ê°€ ëª»ì°¾ì•„ì„œ 1ë ˆë²¨ì´ë¼ë„ ì°¾ì•˜ë˜ê°€ ì•„ë¬´íŠ¼ ííŒ©í•˜ë‚˜ì°¾ê¸° ì„±ê³µí•˜ë©´
      virtualBag.push(heal[1]); // heal[0] â‡’ list ë‚´ì˜ ìˆœì„œ ëª‡ë²ˆì§¸ì¸ì§€, heal[1] â‡’ ê·¸ idxê°€ ë¨¼ì§€ ì •ë³´ë¥¼ ë‹´ìŒ. heal[1] ì´ë‹ˆê¹Œ idxê°€ ë“¤ì–´ê°€ëŠ”ê±°ê² ì§€
      //log("   ã„´ ì°¾ì•˜ìŒ ì°¾ì•„ë„£ê¸° 4. ë‘ë²ˆì§¸ííŒ© ì°¾ì•„ì„œ ì¡ì•„ë„£ìŒ. ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1]);
      list.splice(heal[0], 1); // íì•½ ì¼ìœ¼ë©´ ë°”êµ¬ë‹ˆì—ì„œ ë¹¼ë‚´ì„œ ë²„ë¦°ë‹¤
    }
  }
  
  // 5. ê·¸ë˜ë„ ì•ˆë‚˜ì˜¤ë©´ ì•„ë¬´ê±°ë‚˜ ê³„ì† ì¡ì•„ë„£ì–´ë¼
  //log('ê°€ìƒë°± í¬ê¸°:'+ virtualBag.length + " vs ë‚´ ê°€ë°©ê³µê°„í¬ê¸°: "+ rooms + "ì—ì„œ ì´ì œ ì•„ë¬´ê±°ë‚˜ ë„£ì–´ë³¼ê¹Œìš”?");
  var baku = 0;
  while(virtualBag.length < rooms && list.length > 0) {
    //log("   ã„´ " + baku++ + 'ë²ˆì§¸ í…œì§‘ì–´ë„£ê¸°. ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼: ' + basketInfo(list)  + ' / ë°”êµ¬ë‹ˆ ë¬¼ê±´ìˆ˜: ' + list.length + 'ê°œ');
    //log("   ã„´ í…œì°¾ì•„ë„£ê¸° ë¬´í•œ. ì•„ë¬´ê±°ë‚˜ ì°¾ì•„ì„œ "+list[0]+"ë¥¼ ì¶”ê°€ë¡œ ì¡ì•„ë„£ìŒ. ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1]);
    virtualBag.push(list[0]);
    list.splice(0, 1); // ì“´ ë²ˆì§¸ì˜ ë¬¼ê±´ì€ ë°”êµ¬ë‹ˆì—ì„œ ë¹¼ë‚´ì„œ ë²„ë¦°ë‹¤.
    //log("   ã„´ í…œì°¾ì•„ë„£ì€ ë’¤ì˜ ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1] + ' , ë°”êµ¬ë‹ˆ ë‚´ìš©ë¬¼: ' + basketInfo(list)  + ' / ë°”êµ¬ë‹ˆ ë¬¼ê±´ìˆ˜: ' + list.length + 'ê°œ');
  }
  
  // ì´ë ‡ê²Œê¹Œì§€ í–ˆëŠ”ë° ì•„ì´í…œ ë‹¤ ëª»ì¤ì–´ë‹´ìœ¼ë©´ ê³¤ë€í•˜ê² ì§€ ê·¸ë ‡ê² ì§€
  
  // âœ…ë¡œê·¸ ë° ğŸ…¾ï¸ë³€ìˆ˜ì¡°ì‘ë¶€
  // ì´ì‹œì ì—ì„  ê°€ë°©ì— ë„£ì„ë¬¼ê±´ì´ ì„ ì •ë˜ì–´ìˆë‹¤. ê°€ë°©ì— ë¬¼ê±´ì„ ë„£ëŠ” ë¶€ë¶„ì´ë‹¤
  //log("ë¬¼ê±´ ì„ ì • ë. ê°€ë°© ì‘¤ì…”ë„£ê¸° ì‹œì‘ >>");
  if(rooms == 0) { // 1. ê°€ë°©ì´ ì—†ìœ¼ë©´
    //log("   ã„´ ê°€ë°©ì´ ì—†ì–´ì„œ ì§ì •ë¦¬ ë¶ˆìš”.")
    //var logtxt = pl[1] + pl[2] + ": ì§ì •ë¦¬ ë¶ˆìš” (ì†Œì§€í’ˆì„ ë„£ì„ ê°€ë°©ì´ ì—†ìŒ)";
    return ['ì—†ìŒ', pl];
  } else { // 2. ê°€ë°©ì´ ìˆë‹¤ë©´
    //log("   ã„´ ê°€ë°© ìˆê³ , ì‡¼í•‘ë°± ê°œìˆ˜ "+virtualBag.length + ": ë‚´ìš©ë¬¼ " + virtualBag[0]+", "+virtualBag[1]);
    if(!isEmpty(virtualBag)) { // 2-1. ê°€ë°©ì— ë„£ì„ ë§Œí•œ ì•„ì´í…œë„ ìˆë‹¤ë©´
      var logtxt = pl[1] + pl[2] + ": ê°€ë°©ì— ";
      for(var i in virtualBag) {
        pl[Number(13)+Number(i)] = virtualBag[i]; // ğŸ…¾ï¸ ë²„ì¶”ì–¼ë°±ì—ì„œ ìˆœì„œëŒ€ë¡œ plì— ë°˜ì˜
        logtxt += item[virtualBag[i]][2]; // ë¡œê·¸ë©”ì„¸ì§€ ì¶”ê°€
        //log('   ã„´ì‡¼í•‘ë°±'+i+'ë²ˆì„ í”Œë ˆì´ì–´ '+(Number(13)+Number(i) == 13? 1:2)+'ë²ˆì§¸ ê°€ë°©ì— ë‚´ìš©ë¬¼ ë„£ì€ ê²°ê³¼, ì¡°íšŒí•˜ë©´ \''+pl[Number(13)+Number(i)] +"' ì´ë ‡ê²Œ ë‚˜ì˜¬ê²ƒì„.");
      }
      logtxt += " ë³´ìœ ";
    } else { // 2-2 ê°€ë°©ì— ë„£ì„ í…œì´ ì—†ë‹¤ë©´
      //var logtxt = pl[1] + pl[2] + ": ì§ì •ë¦¬ ë¶ˆìš” (ì •ë¦¬í•  ì†Œì§€í’ˆì´ ì—†ìŒ)";
      return ['ì—†ìŒ', pl];
    }
  }
  
  return [logtxt, pl]; // ë‚¨ëŠ” ì•„ì´í…œì€ ë‹¤ ë²„ë¦¬ëŠ” ê±°ë¼ì„œ ë¦¬í„´ ì•ˆí•˜ê³  íœ˜ë°œì‹œí‚¤ë„ë¡í•¨.
}

////////// ì•„ì´í…œ ë°”êµ¬ë‹ˆ([idx, eff]ë¡œ ì´ë£¨ì–´ì§„ 2ì°¨ì› ë°°ì—´)ì„ ë“¤ë ¤ì£¼ë©´ ì•„ì´í…œì˜ ì •ë³´ë¥¼ ë¬¸ìì—´ í˜•íƒœë¡œ ëŒë ¤ì¤Œ /////////
function basketInfo(list) {
  var txt = '';
  if(typeof list != 'object') return;
  for(var i in list) {
    // ë¬¼í’ˆì˜ ì¥ë¹„ idx ë° ì˜µì…˜ì„ êµ¬í•¨
    // ë°°ì—´ ë‘ê°œì§œë¦¬ë©´ íš¨ê³¼ìˆ˜ì¹˜ë„ ê°™ì´ ë“¤ì–´ìˆëŠ”ê²ƒì„ (íƒˆê²ƒë“±) / ë°°ì—´ í•œê°œì§œë¦¬ë©´ ë‹¨ìˆœí…œì„
    if (list[i].length >= 2) { var idx = list[i][0]; var eff = list[i][1]; }
    else { var idx = list[i]; var eff = 'no'; }
    
    txt += item[idx][2] + idx + '-' + item[idx][3];
    if(eff != 'no') txt += "x" + eff;
    txt += ' ';
  }
  return txt;
}
////////// ì•„ì´í…œ ë°”êµ¬ë‹ˆ([idx,eff]ë“¤ë¡œë§Œ ì´ë£¨ì–´ì§„ ë°°ì—´)ë‘, ì°¾ëŠ” ì•„ì´í…œ ì¢…ë¥˜, ìœ„ë ¥ì„ ì •í•´ì£¼ë©´ ì•„ì´í…œ DBì—ì„œ ì´ê²Œ ëª‡ ë²ˆì§¸ ìš”ì†Œì¸ì§€ë‘ í•´ë‹¹ idx ë¦¬í„´í•´ì¤Œ. ////////////
function findObj(list, objectType, targetPower){
  var foundIdx = 'none';
  var order = 'none';
  if(typeof list != 'object') return;
  for(var i in list) {
    // 1. íƒ€ì…ëª… ë§ì¶°ë³´ê¸°
    if(list[i].length >= 2) var targetIdx = list[i][0]; // ë°°ì—´ ë‘ê°œì§œë¦¬ë©´ íƒˆê²ƒì€ ì•„ê¹Œ ë²„ë ¸ìœ¼ë‹ˆê¹Œ ì´ê±´ íŠ¹ìˆ˜ì•„ì´í…œì¼ê²ƒì´ë¯€ë¡œ íš¨ê³¼ìˆ˜ì¹˜ë„ ê°™ì´ ë“¤ì–´ìˆëŠ”ê²ƒì„
    else var targetIdx = list[i]; // ë°°ì—´ í•œê°œì§œë¦¬ë©´ ë‹¨ìˆœí…œì„
    var type = item[targetIdx][1]; // íƒ€ì…ëª… ë”°ì˜´
    if(type == objectType){ // 2. íƒ€ì…ì´ ë§ëŠ”ë‹¤ë©´ ìœ„ë ¥ ë§ì¶°ë³´ê¸°
      if(targetPower === undefined) { order = i; foundIdx = targetIdx; } // ì°¾ëŠ” ìœ„ë ¥ ì§€ì • ì•ˆë¼ìˆë‹¤ë©´ ë°”ë¡œ idx ì„¤ì •
      else if(item[targetIdx][3] == targetPower) { order = i; foundIdx = targetIdx; }// ì°¾ëŠ” ìœ„ë ¥ ì§€ì • ë¼ìˆë‹¤ë©´ ìœ„ë ¥ì— ë§ì„ë•Œë§Œ idx ì„¤ì •
    }
  }
  return [order, foundIdx];
}

////////// í”Œë ˆì´ì–´ ë°°ì—´ì„ ë„˜ê²¨ì£¼ë©´ ê°€ë°© ë¹ˆê³µê°„ ìˆ˜ë¥¼ ëŒë ¤ì¤Œ ////////
function getBagRooms(pl) {
  if (pl[12] == 'x') {
    var space = 0; // ê°€ë°©ì´ ì—†ìœ¼ë©´ ë‹¹ì—°íˆ ë¹ˆê³µê°„ì€ 0ì´ë‹¤  
    //log('ê°€ë°©:' + pl[12]);
  } else { // ê°€ë°©ì´ ìˆì„ë•Œ, ê°€ë°©ê³¼ ë³´ê´€í•¨ì˜ í¬ê¸°ì— ë”°ë¼ì„œ ë¹ˆê³µê°„ ê²€ì‚¬
    var rooms = item[pl[12]][3]; // ê°€ë°©ì´ ê°€ì§„ ì¹¸ìˆ˜    
    //log('ê°€ë°©ì´ ê°€ì§„ ì¹¸ìˆ˜:'+rooms);
    if (rooms == 1) { // ê°€ë°© í•œì¹¸ì§œë¦¬ì¼ë•Œ
      //log('ê°€ë°© í•œì¹¸ì§œë¦¬ì„');
      if(pl[13] != 'x') var space = 0; // ë³´ê´€í•¨1ì— ë­ ìˆìœ¼ë©´ space 0
      else var space = 1; // ë³´ê´€í•¨1ì— ë­ ì—†ìœ¼ë©´ space 1      
    } else if (rooms == 2) { // ê°€ë°© ë‘ì¹¸ì§œë¦¬ì¼ë•Œ
      //log('ê°€ë°© ë‘ì¹¸ì§œë¦¬ì„');
      if(pl[13] == 'x' && pl[14] == 'x') var space = 2; // ë³´ê´€í•¨ 1, 2 ë‘˜ë‹¤ ë¹„ì—ˆìœ¼ë©´ space 2
      else if(pl[13] != 'x' && pl[14] == 'x') var space = 1; // ë³´ê´€í•¨ 1 ë­ ìˆëŠ”ë° 2ê°€ ë¹„ì—ˆìœ¼ë©´ space 1
      else if(pl[13] != 'x' && pl[14] != 'x') var space = 0; // ë³´ê´€í•¨ 1, 2 ë‘˜ë‹¤ ë­ ìˆìœ¼ë©´ space 0
    }
  }
  //log("ê°€ë°© ì—¬ìœ ê³µê°„:" + space);
  return space; // ê³„ì‚°ëœ ë¹ˆê³µê°„ì˜ ìˆ˜ ë¦¬í„´
}
