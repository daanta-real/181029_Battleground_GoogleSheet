/*
âœ… = ë©”ì¸í™”ë©´ ì˜¤ë¥¸ìª½ ë¡œê·¸ ì¡°ì‘
ğŸ…¾ï¸ = DBìš© ë³€ìˆ˜ë¥¼ ì¡°ì‘
ğŸ—ºï¸ï¸ = ë§µí™”ë©´ ì¡°ì‘
ğŸš¹ = ìŠ¤í…Œì´í„°ìŠ¤ í™”ë©´ ì¡°ì‘
ğŸ’Ÿ = í–¥í›„ ì—…ë°ì´íŠ¸ í•„ìš”
â“‚ï¸ = ë””ë²„ê·¸ í‘œì‹œ
//debugConsoleLog('#1/25. ' + pl[1]+pl[2]);
*/

function debugTest() { // í”Œë ˆì´ì–´ë³„ ë£¨í‹´ í˜ì´ì¦ˆ
  loop_main('on');
  //refresh();
}
////////////////////////â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸////////////////////////
function debugInfVer() { // ê³„ê¸°íŒì—ì„œ ì‹¤í–‰í•˜ëŠ” ë””ë²„ê·¸
}
////////////////////////â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸â“‚ï¸////////////////////////


//ë£¨í”„ ì‹¤ì œë¡œ êµ¬ë™ë˜ëŠ” í•µì‹¬ë¶€ë¶„.
// ë£¨í”„ 1. loop_chk(ê²Œì„ ì‹œì‘/ì¢…ë£Œ/íŠ¸ë¦¬ê±° ë“±ì˜ ì ‘ì´‰ê´€ë¦¬)
// ë£¨í”„ 2. loop_player(í”Œë ˆì´ì–´ë³„ í–‰ë™ì²˜ë¦¬)
// ë£¨í”„ 3. loop_system(ìê¸°ì¥,ë ˆë“œì¡´,ê³µì¤‘ë³´ê¸‰,ì„ ë¬¼ìƒì ë“±ì˜ ì²˜ë¦¬)
//ì´ë ‡ê²Œ ì„¸ê°œë¡œ ì´ë£¨ì–´ì§.
function loop_main(debug, turns) {

  // í•„ìš” ë³€ìˆ˜ ì¤€ë¹„
  var player = mg_player.getRange(3, 1, mg_player.getLastRow()-2, mg_player.getLastColumn()).getValues();
  var matzip = mg_matzip.getRange(3, 1, mg_matzip.getLastRow()-2, mg_matzip.getLastColumn()).getValues();

  var currTurn = mg_main.getRange(7, 5).getValue(); // ê²Œì„ìƒíƒœ ë³€ìˆ˜ (í„´ìˆ˜ì— ë”°ë¼ í–‰ë™ë³€í™”)
  var server = mg_main.getRange(6, 15).getValue(); // ì„œë²„ìƒíƒœ ë³€ìˆ˜ (ê´€ë¦¬ìê°€ ON/OFFë¡œ ì…ë ¥í•˜ì—¬ ê²Œì„ì„ ì§„í–‰/ì¤‘ë‹¨ì‹œí‚´)
  var calc = mg_main.getRange(7, 15).getValue(); // ë©”ì¸ì‹œíŠ¸ì˜ 'CALC'í•­ëª©ìœ¼ë¡œ ì ê²€í• ê±°  
  
  var lastTime = mg_main.getRange(8,15).getValue(); // ê¸°ë¡ëœ ë§ˆì§€ë§‰ í„´ ì‹œì‘ì‹œê°„ ('ìµœê·¼ í„´'ë€) (* ì´ê²Œ ì „ ë¼ìš´ë“œ ì¢…ë£Œì‹œê°ì´ë‹¤.)
  var elapsedHours = Math.floor((new Date() - new Date(lastTime))/(1000*60*60)); // ìƒê¸° ë§ˆì§€ë§‰ í„´ì‹œì‘ì‹œì ìœ¼ë¡œë¶€í„° ì§€ë‚œ ì‹œê°ëŸ‰
  var elapsedMins = Math.floor((new Date() - new Date(lastTime))/(1000*60)); // ìƒê¸° ë§ˆì§€ë§‰ í„´ì‹œì‘ì‹œì ìœ¼ë¡œë¶€í„° ëª‡ë¶„ ì§€ë‚¬ëŠ”ì§€ ê³„ì‚°í•¨.
  var elapsedH = Math.floor(elapsedMins/60);
  var elapsedM = (elapsedMins % 60);
  if(debug == 'on') log("[SYSTEM] ë§ˆì§€ë§‰ ì‹¤í–‰ìœ¼ë¡œë¶€í„° " + elapsedHours + "ì‹œê°„ / " + elapsedH  + "ì‹œê°„ " + elapsedM + 'ë¶„ ì§€ë‚¬ìŠµë‹ˆë‹¤. debug = ' + debug);
  
  var nextTurn_raw = new Date(new Date().getTime() + 1000*60*60*routineHour); // xì‹œê°„í›„ (í˜„ì¬0.5ì‹œê°„ì¼ê±¸)
  var nextTurnTime = Utilities.formatDate(new Date(nextTurn_raw), 'GMT+9', 'MM/dd HH:mm:ss'); // xì‹œê°„í›„ - í¬ë§·ë§Œ ë‹¤ë¥´ê³  ì—‘ì…€ì…ë ¥í•˜ë©´ ê°’ì€ ë˜‘ê°™ìŒ (í˜„ì¬24ì‹œê°„ì¼ê±¸)
  
  // debugConsoleLog(new Date() + ", (last)Turn:" + currTurn + ", lastTime=" + lastTime + ", elapsed " + elapsedH  + "ì‹œê°„ " + elapsedM + 'ë¶„ --- ë£¨í‹´ ì§„í–‰í•©ë‹ˆë‹¤.');

  // ë£¨í”„ 0. game_chk(ê²Œì„ ì‹œì‘/ì¢…ë£Œ/íŠ¸ë¦¬ê±° ë“±ì˜ ì ‘ì´‰ê´€ë¦¬)
  // ì²´í¬ ë£¨í”„ë¥¼ ëˆë‹¤.
  
  // 1. ì„œë²„ìƒíƒœ ì ê²€ë¶€: ì„œë²„ ON?
  // ê²Œì„ì„ ì„ì˜ë¡œ ë©ˆì·„ë‹¤ë©´ (ì„œë²„ ìƒíƒœê°€ ONì´ ì•„ë‹ˆë©´)
  if(server != 'ON') { // ì„œë²„ ìƒíƒœê°€ ONì´ ì•„ë‹Œ ë‹¤ë¥¸ ì–´ë–¤ê²ƒì´ë©´
    log("[SYSTEM] ë””ë²„ê·¸ ê´€ê³„ë¡œ ê²Œì„ì´ ì ì‹œ ë©ˆì·„ìœ¼ë©°, ì†í–‰ ì˜ˆì •ì…ë‹ˆë‹¤.");
    return; // í„´ì¢…ë£Œ í–‰ë™ì´ê³  ë­ê³  ê·¸ëƒ¥ ë°”ë¡œ ì…§ë‹¤ìš´í•´ë¼
  }  
  
  // 2. ì—°ì‚°ìƒíƒœ ì ê²€ë¶€: LOADING / IDLE ? â†’ LOADING í‘œê¸°ëœì´í›„ 15ë¶„ì´ ì§€ë‚¬ëŠ”ê°€? ê·¸ë¦¬ê³  LOADINGì¤‘ì¸ê°€?
  if (calc == 'LOADING' && elapsedHours > routineHour) { // ì¦‰ ì—°ì‚°ì´ ì§„í–‰ì¤‘ì´ê³ , ê·¸ ì±„ë¡œ í•œ ë£¨í‹´ë¶„ëŸ‰ì˜ ì‹œê°„ì´ ì§€ë‚¬ìœ¼ë©´ â†’ í‹€ë¦¼ì—†ì´ ì¤‘ê°„ì— ë»‘ë‚œê±°ì„
    log("[SYSTEM] " + elapsedH  + "ì‹œê°„ " + elapsedM + 'ë¶„ì´ ì§€ë‚˜ë„ë¡ ì§€ë‚œ í„´ì„ ë§ˆì¹˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤. ì—ëŸ¬ê°€ ë‚˜ê¸° ì§ì „ í„´ìœ¼ë¡œ ë°±ì„­í•©ë‹ˆë‹¤.');
    backsub(); // ë°±ì„­ë§Œ í•˜ê³  ì¬ì‹œë„
    log('ë°”ë¡œ ì „ í„´ìœ¼ë¡œ ë°±ì„­ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤. ê²½ê¸°ë¥¼ ë‹¤ì‹œ ì§„í–‰í•©ë‹ˆë‹¤.');
  } else if (calc == 'LOADING') {
    log("[SYSTEM] ì„ í–‰ì—°ì‚° ì§„í–‰ì¤‘ìœ¼ë¡œ ì¤‘ë³µì—°ì‚° ë°©ì§€ë¥¼ ìœ„í•´ ë³¸ ë£¨í‹´ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.");
    return;
  }
  
  // 3. ìƒˆë¼ìš´ë“œ ì‹œì‘ë¶€: ê²œ ì¢…ë£Œë° ë‹¤ìŒë¼ìš´ë“œ ëŒ€ê¸°ì¤‘?
  if(currTurn == 'ì¢…ë£Œ') { // ê²Œì„ì´ ì¢…ë£Œë˜ì–´ ë‹¤ìŒ ë¼ìš´ë“œë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ìƒíƒœë¼ë©´ (í„´ = 'ì¢…ë£Œ'ì¼ ë•Œ)
    // í˜„ì¬ì‹œê°ì´ ê²Œì„ ê°œì‹œì‹œê° ~ +8ì‹œê°„ ë²”ìœ„ ì´ë‚´ì´ê±°ë‚˜, ë””ë²„ê·¸ëª¨ë“œê°€ ì¼œì ¸ìˆë‹¤ë©´
    if((new Date().getHours() >= nextGameStartHour && new Date().getHours() < nextGameStartHour + 8) || debug == 'on') {
      startRound(); // ì•„ì¹¨ 10ì‹œê°€ ì§€ë‚¬ë‹¤ë©´ ìƒˆê²Œì„ ìŠ¤íƒ€íŠ¸ì‹œí‚´. 0í„´ìœ¼ë¡œ ì‹œì‘í•˜ë©°, ë°‘ì— ë©”ì¸ë£¨í”„ë¥¼ ëŒë©´ì„œ í„´+1 ë˜ë©° ë°”ë¡œ ê²Œì„ ì‹œì‘í•¨.
      player = mg_player.getRange(3, 1, mg_player.getLastRow()-2, mg_player.getLastColumn()).getValues();
      matzip = mg_matzip.getRange(3, 1, mg_matzip.getLastRow()-2, mg_matzip.getLastColumn()).getValues();
    } else {
      return ;// ê²œì€ ì¢…ë£Œìƒíƒœê³  24ì‹œê°„ì´ ì•„ì§ ì•ˆ ì§€ë‚¬ë‹¤ë©´ ì„œë²„ê°€ í• ê²Œì—†ë‹¤. í„´ì¢…ë£Œ í–‰ë™ì´ê³  ë­ê³  ê·¸ëƒ¥ ë°”ë¡œ ì…§ë‹¤ìš´í•´ë¼
    }
  }
  if(debug == 'on') log("ê²½ê¸°ê°€ ì¢…ë£Œìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ìŒ í„´ì„ ì •ìƒì§„í–‰í•©ë‹ˆë‹¤.");
  
  
  // ë£¨í”„ 0. ì—¬ê¸°ê¹Œì§€ ì™”ìœ¼ë©´ ì„œë²„ëŠ” ì¼œì ¸ ìˆê³ , ìƒì¡´ìê°€ 2ëª… ì´ìƒ ìˆë‹¤ ì¦‰ ê²Œì„ì´ ë³¸ê²© ì •ìƒì§„í–‰ì¤‘ì´ë¼ëŠ” ì–˜ê¸°ë‹¤.
  // ìƒˆ í„´ì„ ì§„í–‰í•œë‹¤. (* player, matzip, currTurnì„ ìœ„ì—ì„œ ë¶ˆëŸ¬ì™€ì„œ ê°–ê³ ì‡ìŒ)
  
  mg_main.getRange(7,15).setValue("LOADING").setFontColor("#c84533"); // CALC = ë¡œë”©
  mg_main.getRange(8,15).setValue(new Date()); // 'ìµœê·¼ í„´' â‡’ í˜„ì¬ ì‹œê°ì„ ê¸°ë¡
  var logtxt = []; // ë£¨í‹´ì„ ëë‚´ê³  ì—…ë°ì´íŠ¸í•  ì‹œìŠ¤í…œ ë©”ì„¸ì§€ ì „ì²´ëª©ë¡
  currTurn = mg_main.getRange(7, 5).getValue(); // ê²Œì„ìƒíƒœ ë³€ìˆ˜ (í„´ìˆ˜ì— ë”°ë¼ í–‰ë™ë³€í™”)
  var roundStartTime = mg_roundlog.getRange(mg_roundlog.getLastRow(), 2).getValue();
  roundStartTime = new Date(roundStartTime).getDate();
  var todayDay = new Date().getDate();
  if(debug == 'on') log("ë¼ìš´ë“œ ì‹œì‘ì´ ëª‡ì‹œ?=" + roundStartTime + " / ì˜¤ëŠ˜ ë©°ì¹ ?=" + todayDay + " / ê°™ì€ë‚ ì§œì„?=" + (roundStartTime == todayDay));
  
  if(debug >= 0) { log("ë””ë²„ê·¸ ëª¨ë“œ on. " + debug + "ê°œì˜ í„´ì„ ì§„í–‰í•©ë‹ˆë‹¤"); var lackedTurns = debug; } // ë””ë²„ê·¸ ëª¨ë“œë©´, ë„˜ê²¨ë°›ì€ ìˆ«ìë¥¼ ë‚¨ì€ í„´ìˆ˜ë¡œ.
  else if(roundStartTime != todayDay) { var lackedTurns = 5; } // ìì •ì´ ë„˜ì—ˆëŠ”ë°ë„ ê²Œì„ì´ ì•ˆ ëë‚˜ë©´, ë¬´ì¡°ê±´ 5 (ë¹¨ë¦¬ì§„í–‰)
  else { var lackedTurns = getEstimatedRoutines() - currTurn; } // ê·¸ ì™¸ì—” ì²˜ë¦¬í•˜ì§€ ëª»í•œ í„´ìˆ˜ë¥¼ ì„¼ë‹¤.
  var proceededTurns = 0; // í•œë²ˆì— ìµœëŒ€ 5í„´ê¹Œì§€ë§Œ ì²˜ë¦¬í•˜ë„ë¡..
  if(debug == 'on') log( lackedTurns + "í„´ ë” ì§„í–‰í•´ì•¼ê² ëŠ”ë°ìš”.");
  while(lackedTurns > 0 && proceededTurns < 5) {
  
    currTurn = currTurn + 1;
    
    // ë£¨í”„ 2. ìƒˆë¼ìš´ë“œ ì‹œì‘ ~ ë‚™í•˜ì‚° ì°©ì§€ê¹Œì§€: ê²Œì„ ì§„í–‰ í„´ìˆ˜ë³„ ì ê²€ - ë‚™í•˜ì‚°í´ê¸°ì „ì„? / ë‚™í•˜ì‚°í´ëŠ”í„´ì„?
    if(currTurn < parachuteTurn) { // 2-1) ê²Œì„ì´ ì‹œì‘ëœ ìƒíƒœì´ê³ , ë‚™í•˜ì‚° ì•„ì§ í´ì ¸ìˆëŠ” ë‹¨ê³„ë©´ (í„´ê¸°ì¤€ = 10í„´. 30ë¶„ë‹¹ 1í„´ì´ë©´ 10í„´=300ë¶„=5ì‹œê°„ì„) ì „ì´ë©´
      if(debug == 'on') log("ì•„ì§ ë‚™í•˜ì‚° íƒ€ëŠ” ì¤‘.ì§€ìƒì— ì°©ë¥™í•˜ê¸° " + (parachuteTurn - currTurn) + "í„´ ì „");
      logtxt.push(["â˜‚ï¸â˜‚ï¸â˜‚ï¸ ìŠ¤í„°ë””ì›ë“¤ì´ ë‚™í•˜ì‚°ì„ íƒ€ê³  í™œê°•ì¤‘ì…ë‹ˆë‹¤. ì§€ìƒì— ì°©ë¥™í•˜ê¸° " + (parachuteTurn - currTurn) + "í„´ ì „ì…ë‹ˆë‹¤.. â˜‚ï¸â˜‚ï¸â˜‚ï¸", currTurn]);
    } else if(currTurn == parachuteTurn) { // 2-2) ê²Œì„ì´ ì‹œì‘ëœ ìƒíƒœê³ , 10í„´ ë˜ë©´ (í„´ = 10ì¼ ë•Œ)
      if(debug == 'on') log("ë‚™í•˜ì‚°ì—ì„œ ì§€ìƒìœ¼ë¡œ ì¸ì œ ë§‰ ì°©ë¥™. í˜„ì¬í„´: " + currTurn);
      player = revealPlayerIcon(player); // í”Œë ˆì´ì–´ ì•„ì´ì½˜ì„ ë‚™í•˜ì‚°ì—ì„œ ì •ìƒìœ¼ë¡œ ë°”ê¾¸ê³ , ë°”ê¿”ì§„ DBë³€ìˆ˜ë¥¼ ëŒë ¤ë°›ëŠ”ë‹¤ (ë§µê°±ì‹ ì´ë‚˜ DBë°˜ì˜ì€ ë§‰íŒì— í• ê²ƒì„)
      logtxt.push(["ëª¨ë“  ìŠ¤í„°ë””ì›ë“¤ì´ ì§€ìƒì— ì°©ì§€í–ˆìŠµë‹ˆë‹¤!", currTurn]); // ì—¬ê¸°ê¹Œì§€ë§Œ í•˜ê³  í„´ ëë‚¸ë‹¤.    
    } else { // 2-3) ê²Œì„ì´ ì‹œì‘í–ˆê³ , 11í„´ ì´í›„ë©´ ì•„ë˜ ë£¨í”„ 3ê³¼ 4ë¥¼ ëˆë‹¤.
      
      // ë£¨í”„ 3. loop_player(í”Œë ˆì´ì–´ë³„ í–‰ë™ì²˜ë¦¬)
      // í”Œë ˆì´ì–´ë³„ ë£¨í”„ë¥¼ ëŒê³ , [logtxt, ìˆ˜ì •ëœplayer, ìˆ˜ì •ëœmatzip] ë³€ìˆ˜ë¥¼ ëŒë ¤ë°›ëŠ”ë‹¤.
      if(debug == 'on') log("í”Œë ˆì´ì–´ë¶€ ì‹œì‘");
      var ploop = loop_player(player, matzip, currTurn);
      if(ploop[0].length > 0) logtxt = logtxt.concat(ploop[0]);
      player = ploop[1], matzip = ploop[2];
      if(debug == 'on') log("í”Œë ˆì´ì–´ë¶€ ë");
      
      // ë£¨í”„ 4. loop_system(ìê¸°ì¥,ë ˆë“œì¡´,ê³µì¤‘ë³´ê¸‰,ë³´ìƒìƒì ë“±ì˜ ì²˜ë¦¬)
      // ì‹œìŠ¤í…œ ë£¨í”„ë¥¼ ëŒê³ , [logtxt, ìˆ˜ì •ëœplayer, ìˆ˜ì •ëœmatzip] ë³€ìˆ˜ë¥¼ ëŒë ¤ë°›ëŠ”ë‹¤.
      var sloop = loop_system(player, matzip, currTurn);
      if(sloop[0] != 'ì—†ìŒ') logtxt = logtxt.concat(sloop[0]);
      player = sloop[1], matzip = sloop[2];
      if(debug == 'on') log("ì‹œìŠ¤í…œë¶€ ë");
      
    }
    
    // ë£¨í”„ 5. ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬ íŒë‹¨í•œë‹¤.
    var lives = 0; for(var i in player) if(player[i][11] > 0) lives++; // HP 1 ì´ìƒìˆëŠ”ë†ˆ ëª…ìˆ˜ (ìƒì¡´ì ëª…ìˆ˜)
    if(lives <= 1) { // 1) ìƒì¡´ìê°€ ì—†ê±°ë‚˜ í•œ ëª…ì´ë¼ë©´ (lives = 1ëª… ì´í•˜ì¼ ë•Œ)
      log(logtxt); // ì¼ë‹¨ ëª¨ë“  ë¡œê·¸í…ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•œë’¤
      finishRound(player, matzip, currTurn); // ê²Œì„ ëë‚´ê¸°ì²˜ë¦¬
      return ; // ë©”ì„¸ì§€ëŠ” í•¨ìˆ˜ì•ˆì—ì„œ ë‹¤ ì¼ë‹¤.. í”„ë¡œê·¸ë¨ ë‹¤ ì¢…ë£Œì‹œì¼œë²„ë ¤ì•¼ë¨.
    } else { // 2) ìƒì¡´ìê°€ ì¶©ë¶„í•˜ë‹¤ë©´ (2ëª… ì´ìƒì¸ ì •ìƒ ìƒí™©ì¼ ê²½ìš°)
      var lives = 0; for(var i in player) if(player[i][11] > 0) lives++; // HP 1 ì´ìƒìˆëŠ”ë†ˆ ëª…ìˆ˜ (ìƒì¡´ì ëª…ìˆ˜)
      logtxt.push(["ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶" + currTurn + "ë²ˆì§¸ í„´ ì¢…ë£Œ! ìƒì¡´ì " + lives + "ëª…, ë‹¤ìŒ í„´ ì‹œê°„: â°" + nextTurnTime + "ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶", currTurn]); // ê²Œì„ ì¢…ë£Œ ì•„ë‹ ë•Œ
    }
    
    lackedTurns--;
    proceededTurns++;
    
  }
  // í„´ ëŒë¦¬ê¸° ë‹¤ëëƒ„
  if(debug == 'on') log("í„´ ëŒë¦¬ê¸° ë‹¤ëëƒ„");


  
  // ë£¨í”„ ëë‚´ê³  ëª¨ë“  ë¡œê·¸ë©”ì„¸ì§€ ì¶œë ¥
  if(debug == 'on') log("ë¡œê·¸ë©”ì„¸ì§€ ì¶œë ¥..");
  if(logtxt.length > 0) log(logtxt);
  // ì—¬ê¸°ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì™”ë‹¤ë©´ í„´ ì¢…ë£Œ ì²˜ë¦¬í•œë‹¤.
  if(debug == 'on') log("í”Œë ˆì´ì–´DB ë°˜ì˜ì¤‘..");
  db_rewrite(mg_player, player); // ë³€ê²½ëœ í”Œë ˆì´ì–´ ë‚´ìš©ì„ DB ì „ì²´ì— ë®ì–´ì“´ë‹¤.
  if(debug == 'on') log("DBë°±ì—…ì™„ë£Œ. ë§›ì§‘DB ë°˜ì˜ì¤‘..");
  db_rewrite(mg_matzip, matzip); // ë³€ê²½ëœ ë§›ì§‘ ë‚´ìš©ì„ DB ì „ì²´ì— ë®ì–´ì“´ë‹¤.
  if(debug == 'on') log("ê²Œì„ ìƒíƒœ ë°±ì—…ì¤‘..");
  game_backup(currTurn); // í˜„ì¬ì‹œì ì˜ DBë¥¼ ë°±ì—…í•œë‹¤.
  
  // ë©”ì¸í™”ë©´ ë‚´ìš©ì„ ê¸°ë¡í•œë‹¤.
  mg_main.getRange(8, 15).setValue(new Date()); // 'ìµœê·¼ í„´' â‡’ í˜„ì¬ ì‹œê°ì„ ê¸°ë¡
  mg_main.getRange(9, 15).setValue(nextTurnTime); // 'ë‹¤ìŒ í„´' ë€ì— ë‹¤ìŒ ì‹œì‘ì‹œê° í™•ì‹¤í•˜ê²Œ ë°•ì•„ë†“ê¸°
  mg_main.getRange(7, 5).setValue(currTurn); // TURN â‡’ ë§ˆì§€ë§‰ìœ¼ë¡œ ëë‚¸ í„´ ê¸°ì…

  // ì‹œìŠ¤í…œì˜ ì™„ì „í•œ ì¢…ë£Œ.
  mg_main.getRange(7, 15).setValue("IDLE").setFontColor("#444444"); // CALC = IDLE
  refresh(); // ëª¨ë“  ë””ìŠ¤í”Œë ˆì´ë¥¼ ê°±ì‹ í•œë‹¤.
}